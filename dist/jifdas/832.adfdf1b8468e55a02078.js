(self.webpackChunkjifdas=self.webpackChunkjifdas||[]).push([[832],{3890:function(t){"use strict";!function(e){function i(t){return window.btoa([].slice.call(new Uint8Array(t)).map(function(t){return String.fromCharCode(t)}).join(""))}t.exports=function(t,e){return"fetch"in window&&"Promise"in window?fetch(t,e||{}).then(function(t){return t.arrayBuffer()}).then(i):Promise.reject("[*] image-to-base64 is not compatible with your browser.")}}()},1832:(t,e,i)=>{"use strict";i.r(e),i.d(e,{FieldModule:()=>F});var n=i(1116),a=i(1462),o=i(5425),s=i(1190),r=i(549),l=i(5366),c=i(3458),d=i(570);let g=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-shell"]],decls:5,vars:0,consts:[[1,"d-flex","flex-column","flex-root"],[1,"page","d-flex","flex-row","flex-column-fluid"],["title","Field Agents Dashboard"]],template:function(t,e){1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l._UZ(2,"app-sidebar"),l._UZ(3,"app-header",2),l._UZ(4,"router-outlet"),l.qZA(),l.qZA())},directives:[c.k,d.G,s.lC],styles:[""]}),t})();var u=i(6673),h=i(8870);function p(t,e=h.P){return i=>i.lift(new m(t,e))}class m{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new f(t,this.dueTime,this.scheduler))}}class f extends u.L{constructor(t,e,i){super(t),this.dueTime=e,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Z,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function Z(t){t.debouncedNext()}var y=i(8720),T=i(9996),D=i(3219),v=i(3890),b=i.n(v),L=i(7320);let A=(()=>{class t{constructor(){this.toasts=[]}show(t,e={}){this.toasts.push(Object.assign({textOrTpl:t},e))}remove(t){this.toasts=this.toasts.filter(e=>e!==t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var q=i(5943),x=i(4126),w=i(1882);function C(t,e){}function M(t,e){if(1&t&&l.YNc(0,C,0,0,"ng-template",4),2&t){const t=l.oxw().$implicit;l.Q6J("ngTemplateOutlet",t.textOrTpl)}}function _(t,e){if(1&t&&l._uU(0),2&t){const t=l.oxw().$implicit;l.Oqu(t.textOrTpl)}}function J(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ngb-toast",1),l.NdJ("hidden",function(){const e=l.CHM(t).$implicit;return l.oxw().toastService.remove(e)}),l.YNc(1,M,1,1,"ng-template",2),l.YNc(2,_,1,1,"ng-template",null,3,l.W1O),l.qZA()}if(2&t){const t=e.$implicit,i=l.MAs(3),n=l.oxw();l.Tol(t.classname),l.Q6J("autohide",!0)("delay",t.delay||5e3),l.xp6(1),l.Q6J("ngIf",n.isTemplate(t))("ngIfElse",i)}}let O=(()=>{class t{constructor(t){this.toastService=t}isTemplate(t){return t.textOrTpl instanceof l.Rgc}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(A))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-toast-container"]],hostVars:2,hostBindings:function(t,e){2&t&&l.ekj("ngb-toasts",!0)},decls:1,vars:1,consts:[[3,"class","autohide","delay","hidden",4,"ngFor","ngForOf"],[3,"autohide","delay","hidden"],[3,"ngIf","ngIfElse"],["text",""],[3,"ngTemplateOutlet"]],template:function(t,e){1&t&&l.YNc(0,J,4,6,"ngb-toast",0),2&t&&l.Q6J("ngForOf",e.toastService.toasts)},directives:[n.sg,x.Iv,n.O5,n.tP],styles:["ngb-toast[_ngcontent-%COMP%]{opacity:1!important}"]}),t})();function I(t,e){if(1&t&&(l.TgZ(0,"option",43),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.s9C("value",t.id),l.xp6(1),l.Oqu(t.text)}}function U(t,e){1&t&&l._UZ(0,"img",44),2&t&&l.MGl("src","data:image/png;base64,",e.$implicit,"",l.LSH)}const S=[{path:"",component:g,canActivate:[r.P],children:[{path:"new-incidence",component:(()=>{class t{constructor(t,e,i){this.serverRequest=t,this.toastService=e,this.storage=i,this.select2Options={containerCssClass:"form-control",width:"100%"},this.select2Options_multiple={containerCssClass:"form-control",width:"100%",multiple:!0},this.select2Data={countryList:[],regionList:[],stateList:[],lgaList:[],wardList:[],villageList:[],localityList:[],incidentCategoryList:[],incidentTypeList:[],factionList:[],friendlyForcesList:[],terrainList:[],associatedFeatureList:[]},this.leafletOptions={layers:[D.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,attribution:"...",subdomains:["mt0","mt1","mt2","mt3"]})],zoom:5,center:D.latLng(11,6)},this.formData={},this.searchCountries=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.countryList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchRegions=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.regionList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchStates=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.stateList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchLGAs=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.lgaList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchWards=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.wardList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchVillages=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.villageList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10))),this.searchLocalities=t=>t.pipe(p(200),(0,y.x)(),(0,T.U)(t=>""===t?[]:this.select2Data.localityList.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10)))}ngOnInit(){this.storage.getItem("sessionInfo").subscribe(t=>{t=JSON.parse(t),this.userId=t.userId}),this.initFormData(),this.loadCountries(),this.loadIncidentTypes(),[{id:"faction",list:"factionList"},{id:"friendly_forces",list:"friendlyForcesList"},{id:"terrain",list:"terrainList"},{id:"associated_feature",list:"associatedFeatureList"}].forEach(t=>{this.loadMetadata(t.id,t.list)})}initFormData(){this.formData={country:"",region:"",state:"",lga:"",ward:"",village:"",locality:"",incidentTitle:"",incidentCategory:"",incidentType:"",faction:[],friendlyForces:[],terrain:[],associatedFeatures:[],kia:0,mia:0,wia:0,civilliansKilled:0,civilliansAbducted:0,criminalsKilled:0,suspectsArrested:0,comments:"",files:[]}}loadCountries(){this.loadSpatialEntityList("countryList","spatial-entity/entity/view-entities-by-type?entityType=1")}loadSpatialEntityChildren(t,e){""!=e&&this.loadSpatialEntityList(t,"spatial-entity/entity/view-entity-children?entityId="+e)}loadSpatialEntityList(t,e){this.serverRequest.get(e).subscribe(e=>{this.select2Data[t]=[],e.contentData.forEach(e=>{this.select2Data[t].push(e.EntityName)})})}loadRegions(t){this.loadSpatialEntityChildren("regionList",this.formData.country)}loadStates(t){this.loadSpatialEntityChildren("stateList",this.formData.region)}loadLgas(t){this.loadSpatialEntityChildren("lgaList",this.formData.state)}loadWards(t){this.loadSpatialEntityChildren("wardList",this.formData.lga)}loadVillages(t){this.loadSpatialEntityChildren("villageList",this.formData.ward)}loadLocalities(t){this.loadSpatialEntityChildren("localityList",this.formData.village)}loadIncidentCategories(){this.serverRequest.get("incidents/incident-type/view-categories").subscribe(t=>{this.select2Data.incidentCategoryList=[]})}loadIncidentTypes(){this.serverRequest.get("incidents/incident-type/view-incident-types?resourceId=1").subscribe(t=>{this.select2Data.incidentTypeList=[],t.contentData.forEach(t=>{this.select2Data.incidentTypeList.push({id:t.IncidentTypeId,text:t.IncidentTypeName})})})}loadMetadata(t,e){}saveIncidence(){void 0===this.formData.poiLatitude&&""==this.formData.poiLatitude||(this.formData.poiLatitude=0),void 0===this.formData.poiLongitude&&""==this.formData.poiLongitude||(this.formData.poiLongitude=0);let t={name:this.formData.incidentTitle,type:this.formData.incidentType,location:{country:this.formData.country,region:this.formData.region,state:this.formData.state,lga:this.formData.lga,ward:this.formData.ward,village:this.formData.village,locality:this.formData.locality},date:new Date(this.formData.incidentDate).toLocaleDateString()+" "+this.formData.incidentTime,pointOfInterest:"POINT("+this.formData.poiLatitude+" "+this.formData.poiLongitude+")",description:this.formData.comments,images:this.formData.files,metadata:[{number_killed_in_action:this.formData.kia},{number_missing_in_action:this.formData.mia},{number_wounded_in_action:this.formData.wia},{number_of_civillians_killed:this.formData.civilliansKilled},{number_of_civillians_abducted:this.formData.civilliansAbducted},{number_of_criminals_killed:this.formData.criminalsKilled},{number_of_suspect_arrested:this.formData.suspectsArrested}]},e={userId:this.userId,incidentData:t};console.log(e),this.serverRequest.post("incidents/incident/new-raw-data",e).subscribe(t=>{this.toastService.show("Incidence has been reported successfully",{classname:"bg-success text-white",delay:1e4}),this.initFormData()},t=>{this.toastService.show("An error occurred. Incidence record not reported successfully",{classname:"bg-danger text-white",delay:1e4})})}onMapReady(t){this.map=t,this.marker=D.marker([-10,-10]),this.marker.addTo(t)}updatePoi(){if(void 0!==this.formData.poiLongitude&&void 0!==this.formData.poiLatitude){const t=this.formData.poiLatitude,e=this.formData.poiLongitude;this.map.setView([t,e],16),this.marker.setLatLng([t,e]),this.marker.bindPopup(t+", "+e)}}showImages(t){this.formData.files=[];let e=t.target.files;for(let i=0;i<e.length;i++){let t=URL.createObjectURL(e[i]);b()(t).then(t=>{this.formData.files.push(t)}).catch(t=>{console.log(t)})}}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(L.I),l.Y36(A),l.Y36(q.V))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-new-incidence"]],decls:93,vars:25,consts:[[1,"page-content",2,"padding","1rem !important","margin-top","50px"],[1,"content-wrapper"],[1,"content"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","header-elements-inline"],[1,"card-title"],[1,"header-elements"],[1,"list-icons"],[1,"card-body"],["action","#"],[1,"col-md-6"],[1,"col-md-4","form-group"],[1,"font-weight-semibold"],["type","text","name","country",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],["type","text","name","region",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],["type","text","name","state",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],["type","text","name","lga",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],["type","text","name","ward",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],["type","text","name","village",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange","change"],[1,"col-md-6","form-group"],["type","text","name","locality",1,"form-control",3,"ngModel","ngbTypeahead","ngModelChange"],[1,"col-md-3","form-group"],["type","text","name","poiLatitude",1,"form-control",3,"ngModel","ngModelChange","change"],["type","text","name","poiLongitude",1,"form-control",3,"ngModel","ngModelChange","change"],[1,"col-md-12","form-group"],["name","incidentType",1,"form-control",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group"],["rows","4","cols","5","placeholder","Enter information about the incident here","name","incidentTitle",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-md-8","form-group"],["type","date","name","incidentDate",1,"form-control",3,"ngModel","ngModelChange"],["type","time","name","incidentTime",1,"form-control",3,"ngModel","ngModelChange"],["rows","7","cols","5","placeholder","Enter your comment / analysis here","name","comments",1,"form-control",3,"ngModel","ngModelChange"],["type","file","name","files","multiple","",1,"form-control",3,"ngModel","change"],["class","img-fluid col-6",3,"src",4,"ngFor","ngForOf"],["leaflet","",2,"height","40vh","margin-top","15px","margin-bottom","10px",3,"leafletOptions","leafletMapReady"],[1,"text-center"],["type","submit",1,"btn","btn-primary","bg-indigo",3,"click"],[1,"icon-paperplane","ml-2"],["aria-live","polite","aria-atomic","true"],[3,"value"],[1,"img-fluid","col-6",3,"src"]],template:function(t,e){1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"div",2),l.TgZ(3,"div",3),l.TgZ(4,"div",4),l.TgZ(5,"div",5),l.TgZ(6,"div",6),l.TgZ(7,"h5",7),l._uU(8,"Record a new Incidence"),l.qZA(),l.TgZ(9,"div",8),l._UZ(10,"div",9),l.qZA(),l.qZA(),l.TgZ(11,"div",10),l.TgZ(12,"form",11),l.TgZ(13,"div",3),l.TgZ(14,"div",12),l.TgZ(15,"div",3),l.TgZ(16,"div",13),l.TgZ(17,"label",14),l._uU(18,"Country:"),l.qZA(),l.TgZ(19,"input",15),l.NdJ("ngModelChange",function(t){return e.formData.country=t})("change",function(t){return e.loadRegions(t)}),l.qZA(),l.qZA(),l.TgZ(20,"div",13),l.TgZ(21,"label",14),l._uU(22,"Region:"),l.qZA(),l.TgZ(23,"input",16),l.NdJ("ngModelChange",function(t){return e.formData.region=t})("change",function(t){return e.loadStates(t)}),l.qZA(),l.qZA(),l.TgZ(24,"div",13),l.TgZ(25,"label",14),l._uU(26,"State:"),l.qZA(),l.TgZ(27,"input",17),l.NdJ("ngModelChange",function(t){return e.formData.state=t})("change",function(t){return e.loadLgas(t)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(28,"div",3),l.TgZ(29,"div",13),l.TgZ(30,"label",14),l._uU(31,"LGA:"),l.qZA(),l.TgZ(32,"input",18),l.NdJ("ngModelChange",function(t){return e.formData.lga=t})("change",function(t){return e.loadWards(t)}),l.qZA(),l.qZA(),l.TgZ(33,"div",13),l.TgZ(34,"label",14),l._uU(35,"Ward:"),l.qZA(),l.TgZ(36,"input",19),l.NdJ("ngModelChange",function(t){return e.formData.ward=t})("change",function(t){return e.loadVillages(t)}),l.qZA(),l.qZA(),l.TgZ(37,"div",13),l.TgZ(38,"label",14),l._uU(39,"Village:"),l.qZA(),l.TgZ(40,"input",20),l.NdJ("ngModelChange",function(t){return e.formData.village=t})("change",function(t){return e.loadLocalities(t)}),l.qZA(),l.qZA(),l.TgZ(41,"div",21),l.TgZ(42,"label",14),l._uU(43,"Locality / Area:"),l.qZA(),l.TgZ(44,"input",22),l.NdJ("ngModelChange",function(t){return e.formData.locality=t}),l.qZA(),l.qZA(),l.TgZ(45,"div",23),l.TgZ(46,"label",14),l._uU(47,"POI Latitude:"),l.qZA(),l.TgZ(48,"input",24),l.NdJ("ngModelChange",function(t){return e.formData.poiLatitude=t})("change",function(){return e.updatePoi()}),l.qZA(),l.qZA(),l.TgZ(49,"div",23),l.TgZ(50,"label",14),l._uU(51,"POI Longitude:"),l.qZA(),l.TgZ(52,"input",25),l.NdJ("ngModelChange",function(t){return e.formData.poiLongitude=t})("change",function(){return e.updatePoi()}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(53,"div",3),l.TgZ(54,"div",26),l.TgZ(55,"label",14),l._uU(56,"Incident Type:"),l.qZA(),l.TgZ(57,"select",27),l.NdJ("ngModelChange",function(t){return e.formData.incidentType=t}),l.TgZ(58,"option",28),l._uU(59,"Select an incident type"),l.qZA(),l.YNc(60,I,2,2,"option",29),l.qZA(),l.qZA(),l.qZA(),l.TgZ(61,"div",30),l.TgZ(62,"label",14),l._uU(63,"Incidence Description:"),l.qZA(),l.TgZ(64,"textarea",31),l.NdJ("ngModelChange",function(t){return e.formData.incidentTitle=t}),l.qZA(),l.qZA(),l.TgZ(65,"div",3),l.TgZ(66,"div",32),l.TgZ(67,"label",14),l._uU(68,"Incidence Date:"),l.qZA(),l.TgZ(69,"input",33),l.NdJ("ngModelChange",function(t){return e.formData.incidentDate=t}),l.qZA(),l.qZA(),l.TgZ(70,"div",13),l.TgZ(71,"label",14),l._uU(72,"Time:"),l.qZA(),l.TgZ(73,"input",34),l.NdJ("ngModelChange",function(t){return e.formData.incidentTime=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(74,"div",30),l.TgZ(75,"label",14),l._uU(76,"Comments / Analysis:"),l.qZA(),l.TgZ(77,"textarea",35),l.NdJ("ngModelChange",function(t){return e.formData.comments=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(78,"div",12),l.TgZ(79,"div",3),l.TgZ(80,"div",30),l.TgZ(81,"label",14),l._uU(82,"Upload Images:"),l.qZA(),l.TgZ(83,"input",36),l.NdJ("change",function(t){return e.showImages(t)}),l.qZA(),l.qZA(),l.TgZ(84,"div",4),l.YNc(85,U,1,1,"img",37),l.qZA(),l.qZA(),l.TgZ(86,"div",38),l.NdJ("leafletMapReady",function(t){return e.onMapReady(t)}),l.qZA(),l.qZA(),l.TgZ(87,"div",4),l.TgZ(88,"div",39),l.TgZ(89,"button",40),l.NdJ("click",function(){return e.saveIncidence()}),l._uU(90,"Submit Incidence Report "),l._UZ(91,"i",41),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l._UZ(92,"app-toast-container",42)),2&t&&(l.xp6(19),l.Q6J("ngModel",e.formData.country)("ngbTypeahead",e.searchCountries),l.xp6(4),l.Q6J("ngModel",e.formData.region)("ngbTypeahead",e.searchRegions),l.xp6(4),l.Q6J("ngModel",e.formData.state)("ngbTypeahead",e.searchStates),l.xp6(5),l.Q6J("ngModel",e.formData.lga)("ngbTypeahead",e.searchLGAs),l.xp6(4),l.Q6J("ngModel",e.formData.ward)("ngbTypeahead",e.searchWards),l.xp6(4),l.Q6J("ngModel",e.formData.village)("ngbTypeahead",e.searchVillages),l.xp6(4),l.Q6J("ngModel",e.formData.locality)("ngbTypeahead",e.searchLocalities),l.xp6(4),l.Q6J("ngModel",e.formData.poiLatitude),l.xp6(4),l.Q6J("ngModel",e.formData.poiLongitude),l.xp6(5),l.Q6J("ngModel",e.formData.incidentType),l.xp6(3),l.Q6J("ngForOf",e.select2Data.incidentTypeList),l.xp6(4),l.Q6J("ngModel",e.formData.incidentTitle),l.xp6(5),l.Q6J("ngModel",e.formData.incidentDate),l.xp6(4),l.Q6J("ngModel",e.formData.incidentTime),l.xp6(4),l.Q6J("ngModel",e.formData.comments),l.xp6(6),l.Q6J("ngModel",e.formData.upload),l.xp6(2),l.Q6J("ngForOf",e.formData.files),l.xp6(1),l.Q6J("leafletOptions",e.leafletOptions))},directives:[a._Y,a.JL,a.F,a.Fj,x.dR,a.JJ,a.On,a.EJ,a.YN,a.Kr,n.sg,w.je,O],styles:["input.form-control[_ngcontent-%COMP%], select.form-control[_ngcontent-%COMP%]{height:40px}"]}),t})()}]}];let N=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[s.Bz.forChild(S)],s.Bz]}),t})(),F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[n.ez,N,o.m,a.u5,w.UO,x.ZS,x.aE]]}),t})()}}]);